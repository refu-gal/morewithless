"use strict";angular.module("morewithlessApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngMaterial"]).config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("red").accentPalette("indigo")}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/company",{templateUrl:"views/company.html",controller:"CompanyCtrl",controllerAs:"company"}).when("/worker",{templateUrl:"views/worker.html",controller:"WorkerCtrl",controllerAs:"worker"}).otherwise({redirectTo:"/"})}]),angular.module("morewithlessApp").controller("MainCtrl",["$location","$mdToast","$scope","$mdDialog","$rootScope","campaign","user","authentification",function(a,b,c,d,e,f,g,h){c.campaigns=[],c.campaigns=f.getAllCampaigns(),c.users=[],c.users=g.getAllusers(),c.currentUser={},h.verifyCredentials(),c.showLoginDialog=function(a){d.show({controller:"LoginDialogController",templateUrl:"views/logindialog.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!0,fullscreen:c.customFullscreen}).then(function(a){c.status='You said the information was "'+a+'".',console.log(c.status)},function(){c.status="You cancelled the dialog.",console.log(c.status)})},c.logout=function(){h.clearCredentials()},c.goToProfile=function(){g.getByUsername(e.globals.currentUser.username).then(function(d){return c.currentUser=d,d.isCompany?void a.path("/company"):d.isAuthorized?void a.path("/worker"):void b.show(b.simple().textContent("A la espera de que tu empresa te autorice!").position("botom").hideDelay(3e3))},function(a){console.error("error is %O",a)})}}]).controller("LoginDialogController",["$scope","$mdDialog","authentification",function(a,b,c){function d(d){d.success?(c.setCredentials(a.loginusername,a.loginpassword),b.hide("login")):(c.clearCredentials(),a.status=d.message)}a.cancel=function(){b.hide()},a.login=function(b,e){console.log("trying to login"),a.loginusername=b,a.loginpassword=e,c.login(b,e,d)}}]),angular.module("morewithlessApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("morewithlessApp").controller("CompanyCtrl",["$scope","$filter","$mdToast","$location","$rootScope","user","campaign",function(a,b,c,d,e,f,g){function h(){f.getFullCompanyByName(e.globals.currentUser.username).then(function(b){a.currentUser=b,b.isCompany||(d.path("/"),c.show(c.simple().textContent("No eres una empresa!!").position("botom").hideDelay(3e3)))},function(a){console.error("error! %O",a)})}a.updateUser=function(b){b.isAuthorized=!b.isAuthorized,b.isAuthorized?a.currentUser.quantity=+a.currentUser.quantity+ +b.quantity:a.currentUser.quantity=+a.currentUser.quantity-+b.quantity,f.updateUser(b).then(function(a){console.log("Update ok!! %O",a)},function(a){console.error("something went wrong when updating! %O",a)})},h()}]),angular.module("morewithlessApp").controller("WorkerCtrl",["$scope","$filter","$mdToast","$location","$rootScope","user","campaign",function(a,b,c,d,e,f,g){function h(a){return"[object Array]"===Object.prototype.toString.call(a)}function i(b){if(a.currentUser.campaigns){var c=b.id;b.selected=-1!=a.currentUser.campaigns.indexOf(c)?!0:!1}return b}function j(){f.getFullUserByName(e.globals.currentUser.username).then(function(b){a.currentUser=b,b.isAuthorized||(d.path("/"),c.show(c.simple().textContent("A la espera de que tu empresa te autorice!").position("botom").hideDelay(3e3))),a.campaigns.map(i)},function(a){console.error("error! %O",a)})}function k(){a.campaigns=g.getAllCampaigns().then(function(b){a.campaigns=b},function(a){console.error("problem getting campaigns")})}function l(){f.updateUser(a.currentUser).then(function(a){console.log("Update ok!! %O",a)},function(a){console.error("something went wrong when updating! %O",a)})}a.firstRefresh=!0,a.campaigns=[],a.currentUser={},a.contributionOptions=[{quantity:1,equivalent:"Café",icon:"fa-coffee",msg:"costear material escolar y libros para un colegio de un niño"},{quantity:3,equivalent:"Cerveza",icon:" fa-beer",msg:"costear gastos de actividades extraescolares y campamentos de verano para menores"},{quantity:5,equivalent:"Copa",icon:"fa-glass",msg:"pagar cursos de formación y fomento de autoempleo de un refugiado"}],a.selectedContribution=function(){if(a.currentUser.quantity){var c=b("filter")(a.contributionOptions,{quantity:a.currentUser.quantity});if(c&&c.length>0)return c[0].msg;console.log(c)}},a.$watch("campaigns",function(b,c){if(void 0!==c&&h(c)&&(0!==Object.keys(c).length||c.constructor!==Object)){if(a.firstRefresh)return a.firstRefresh=!1,void console.log("now changing to firstRefresh %O",a.firstRefresh);for(var d=[],e=0;e<b.length;e++)b[e].selected&&d.push(b[e].id);a.currentUser.campaigns=d}},!0),a.$watch("currentUser",function(a,b){(0!==Object.keys(b).length||b.constructor!==Object)&&"string"!=typeof b.company&&(console.log("user changed %O => %O",b,a),l())},!0),j(),k()}]),angular.module("morewithlessApp").service("campaign",["$resource","$q",function(a,b){function c(){return d.query().$promise}var d=a(location.protocol+"//"+location.host+":8080/campaigns"),e={getAllCampaigns:c};return e}]),angular.module("morewithlessApp").service("user",["$resource","$q",function(a,b){function c(a){var c=b.defer();a.workers=[],a.quantity=0;e().then(function(b){for(var d=0;d<b.length;d++)b[d].company!=a.company||b[d].isCompany||(a.workers.push(b[d]),b[d].isAuthorized&&(a.quantity=+a.quantity+ +b[d].quantity));c.resolve(a)},function(a){c.reject(a),console.error("problem obtaining users")});return c.promise}function d(a){var c=b.defer();e().then(function(b){for(var d=0;d<b.length;d++)b[d].company==a.company&&b[d].isCompany&&(a.company=b[d],c.resolve(b[d]))},function(a){c.reject(a),console.error("problem obtaining users")});return c.promise}function e(){return j.query().$promise}function f(a){return j.get({username:a}).$promise}function g(a){var c=b.defer();return j.get({username:a}).$promise.then(function(a){d(a),c.resolve(a)},function(a){c.reject(data),console.error("error obtaining!")}),c.promise}function h(a){return j.save({username:a.id},a).$promise}function i(a){var d=b.defer();return j.get({username:a}).$promise.then(function(a){c(a),d.resolve(a)},function(a){d.reject(data),console.error("error obtaining!")}),d.promise}var j=a(location.protocol+"//"+location.host+":8080/users/:username",{username:"@username"},{save:{method:"PUT"}}),k={getAllusers:e,getByUsername:f,updateUser:h,getFullUserByName:g,getFullCompanyByName:i};return k}]),angular.module("morewithlessApp").service("company",["$resource",function(a){function b(){return c.query()}var c=a(location.protocol+"//"+location.host+":8080/companies"),d={getAllcompanies:b};return d}]),angular.module("morewithlessApp").service("worker",["$resource",function(a){function b(){return c.query()}var c=a(location.protocol+"//"+location.host+":8080/worker"),d={getAllworkers:b};return d}]),angular.module("morewithlessApp").service("authentification",["$resource","$cookies","$rootScope","user","$http",function(a,b,c,d,e){function f(a,b,c){var e;d.getByUsername(a).then(function(a){e=null!==a&&a.password===b?{success:!0}:{success:!1,message:"Username or password is incorrect"},c(e)},function(a){e={success:!1,message:"Username or password is incorrect"},c(e)})}function g(){return c.globals.username?!0:!1}function h(a,d){var f=k.encode(a+":"+d);c.globals={currentUser:{username:a,authdata:f}},e.defaults.headers.common.Authorization="Basic "+f;var g=new Date;g.setDate(g.getDate()+7),b.putObject("globals",c.globals,{expires:g})}function i(){var a=b.getObject("globals");a&&(c.globals=a,console.log(c.globals))}function j(){c.globals={},b.remove("globals"),e.defaults.headers.common.Authorization="Basic"}var k={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g="",h="",i="",j=0;do b=a.charCodeAt(j++),c=a.charCodeAt(j++),h=a.charCodeAt(j++),d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|h>>6,i=63&h,isNaN(c)?f=i=64:isNaN(h)&&(i=64),g=g+this.keyStr.charAt(d)+this.keyStr.charAt(e)+this.keyStr.charAt(f)+this.keyStr.charAt(i),b=c=h="",d=e=f=i="";while(j<a.length);return g},decode:function(a){var b,c,d,e,f,g="",h="",i="",j=0,k=/[^A-Za-z0-9\+\/\=]/g;k.exec(a)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do d=this.keyStr.indexOf(a.charAt(j++)),e=this.keyStr.indexOf(a.charAt(j++)),f=this.keyStr.indexOf(a.charAt(j++)),i=this.keyStr.indexOf(a.charAt(j++)),b=d<<2|e>>4,c=(15&e)<<4|f>>2,h=(3&f)<<6|i,g+=String.fromCharCode(b),64!=f&&(g+=String.fromCharCode(c)),64!=i&&(g+=String.fromCharCode(h)),b=c=h="",d=e=f=i="";while(j<a.length);return g}},l={login:f,isLogged:g,setCredentials:h,verifyCredentials:i,clearCredentials:j};return l}]),angular.module("morewithlessApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/company.html",'<md-content layout="column" class="layout-padding"> <div layout="column"> <form name="userForm" layout-align="center center"> <md-input-container class="md-block" flex-gt-xs> <label>Nombre</label> <input ng-model="currentUser.name" ng-focus="focusname($event)" disabled> </md-input-container> <md-input-container class="md-block" flex-gt-xs> <label>NIF</label> <input ng-model="currentUser.company" disabled> </md-input-container> <h3>Trabajadores</h3> <md-divider></md-divider> <md-list ng-cloak> <md-list-item ng-repeat="worker in currentUser.workers" layout="row"> <div layout="column" flex layout-wrap> <div layout="row" flex layout-wrap> <p><b> {{worker.id}}</b>: {{ worker.name }}</p> </div> </div> <md-checkbox class="md-secondary" ng-model="worker.isAuthorized" ng-click="updateUser(worker)"></md-checkbox> </md-list-item> </md-list> <md-input-container class="md-block" flex-gt-xs> <label>Contribución total de los trabajadores este mes</label> <input ng-model="currentUser.quantity" disabled> </md-input-container> </form> </div> </md-content>'),a.put("views/logindialog.html",'<md-dialog aria-label="Mango (Fruit)"> <form name="Form" ng-cloak> <md-toolbar> <div class="md-toolbar-tools"> <h2>Login</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-font-icon="fa-close" class="fa s32 md-primary md-hue-2" aria-label="Cancelar"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class="md-dialog-content"> <md-input-container class="md-block"> <label>Login</label> <input type="text" name="username" ng-model="formData.username" placeholder="username" required md-maxlength="10"> <div ng-messages="Form.username.$error" role="alert" multiple> <div ng-message="required" class="my-message">Please enter your email.</div> </div> </md-input-container> <md-input-container class="md-block"> <label>Password</label> <input type="password" name="password" ng-model="formData.password" placeholder="password" required md-maxlength="16"> <div ng-messages="Form.password.$error" role="alert" multiple> <div ng-message="required" class="my-message">Please enter your password.</div> <div ng-message="md-maxlength" class="my-message">Too long.</div> </div> </md-input-container> </div> <span>{{status}}</span> </md-dialog-content> <md-dialog-actions layout="row"> <span flex></span> <md-button ng-disabled="!Form.$valid" ng-click="login(formData.username,formData.password)" aria-label="Acceder">Acceder</md-button> <md-button ng-click="answer()" aria-label="Cancelar">Cancelar</md-button> </md-dialog-actions> </form> </md-dialog>'),a.put("views/main.html",'<section id="main" layout="row" layout-align="center start"> <img src="images/logo.bfc7bc22.png" alt=""> <img src="images/Rocket.8b731238.png"> </section> <section id="comofunciona" layout="row" layout-sm="column" layout-align="start center" layout-wrap> <h1>¿Qu&eacute; hacemos?</h1> <p>MORE WITH LESS establece <a href="legal/modelo-convenio-de-colaboracion.pdf" target="_blank">convenios de colaboración</a> con empresas a través de los cuales los trabajadores y/o las propias empresas donan parte de su sueldo/beneficios para ayudar a financiar distintos proyectos de acción social. </p><p>MORE WITH LESS destina directamente un <a href="http://noticias.juridicas.com/base_datos/Fiscal/l49-2002.cpt2.html#cpa3" target="_blank"> mínimo del 70%</a> de cada donativo para la financiación del proyecto/s elegido/s por los trabajadores y/o empresas. De esta forme MORE WITH LESS ayuda a fomentar la <a href="http://noticias.juridicas.com/base_datos/Fiscal/l49-2002.cpt2.html#cpa3" target="_blank">RESPONSABILIDAD SOCIAL CORPORATIVA</a> entre las empresas. </p></section> <h1>¿C&oacutemo funciona?</h1> <section id="cuantodonar" layout="row" layout-sm="column" layout-align="center center" layout-wrap> <div layout="column" class="md-padding" flex> <md-icon md-font-icon="fa-building" class="fa fa-3x s32 md-primary md-hue-2" aria-label="empresas"></md-icon> <h2>Empresas</h2> Hazte empresa colaboradora y ayúdanos a hacer de este mundo un lugar mejor. Ponte en contacto con nosotros y te explicamos todo lo que necesites saber, mientras tanto puedes descargarte un <a href="legal/modelo-convenio-de-colaboracion.pdf" target="_blank">modelo de convenio de colaboración</a> para que sepas cómo hacemos las cosas. Este convenio lo adaptaremos a tus necesidades. Si estas interesada puedes darte de alta cubriendo el <a href="legal/hazte-social.pdf" target="_blank">siguiente formulario</a> Con poco que nos ayudes podremos hacer grandes cosas: Te enseñamos 2 <ol> <li>Si en tu empresa hay 10 trabajadores y 5 de ellos donan 1 euro y los otros 5 donan 3 euros(20€ en total) permitirás que una persona pueda estar en un centro de acogida; así tendrá asegurada la alimentación, vestimenta y asistencia psicológica.</li> <li>Si en tu empresa hay 10 trabajadores y cada uno dona 3 euros (30€ en total) cubrirás los gastos de asesoramiento legal a un refugiado permitiéndole defender sus derechos.</li> </ol> </div> <div layout="column" class="md-padding" flex> <md-icon md-font-icon="fa-group" class="fa fa-3x s32 md-primary md-hue-2" aria-label="trabajadores"></md-icon> <h2>Trabajadores</h2> <p>Colabora con nosotros donando desde 1 euro de tu nómina y haz realidad distintos proyectos de acción social. Para ello sólo necesitamos firmar un convenio de colaboración con tu empresa.</p> <p><a href="legal/formulario-contacto.pdf" target="_blank">Cubre este formulario</a> y MORE WITH LESS se pondrá en contacto con tu empresa.</p> <p>Con poco dinero se pueden hacer muchas cosas:</p> <p>Donando tan sólo<strong> 1 € al mes</strong> (12€/año) ayudas a proporcionar material escolar y libros de texto para que ningún niño se quede sin ir al colegio.</p> <p>Donando <strong>3 € al mes</strong> (36€/año) ayudas a financiar las actividades extraescolares y campamentos de verano.</p> <p>Donando<strong> 5 € al mes</strong> (60€/año) ayudas a que los refugiados puedan realizar cursos de ocupación profesional.</p> </div></section>   <h1>Empresa morewithless</h1> <section id="empresa" layout="row" layout-sm="column" layout-align="center center" layout-wrap> <div layout-align="center center" layout="column" class="md-padding" flex> <md-icon md-font-icon="fa-trophy" class="fa fa-3x s32 md-primary md-hue-2" aria-label="trabajadores"></md-icon> <h3>Empresa + social</h3> <ul> <li>Se concederá este distintivo a la empresa que posea el porcentaje más alto de trabajadores donantes.</li> <li>En reconocimento a su gran aportación se invitará a uno de los trabajadores a visitar uno de los proyectos en los que participe su empresa.</li> </ul> </div> <div layout-align="center center" layout="column" class="md-padding" flex> <md-icon md-font-icon="fa-gift" class="fa fa-3x s32 md-primary md-hue-2" aria-label="trabajadores"></md-icon> <h3>Empresa + generosa</h3> <ul> <li>Se concederá este distintivo a la empresa que aporte la mayor cantidad de dinero por trabajador.</li> <li>En reconocimiento a su gran aportación se le dará la posibilidad de apadrinar  uno de los proyectos en los que participe.</li> </ul> </div> </section>'),a.put("views/worker.html",'<md-content layout="column" class="layout-padding"> <div layout="column"> <form name="userForm" layout-align="center center"> <md-input-container class="md-block" flex-gt-xs> <label>Compañía</label> <input ng-model="currentUser.company.name" disabled> </md-input-container> <md-input-container class="md-block" flex-gt-xs> <label>Nombre</label> <input ng-model="currentUser.name" ng-focus="focusname($event)"> </md-input-container> <md-input-container class="md-block" flex-gt-xs> <label>NIF</label> <input ng-model="currentUser.nif"> </md-input-container> <h3>Contribución</h3> <md-divider></md-divider> <md-radio-group ng-model="currentUser.quantity" layout="row"> <div ng-repeat="contribution in contributionOptions" class="row" flex> <div class="radioelement" layout="column" layout-align="center center"> <div flex style="max-width:200px" layout="column"> <md-icon md-font-icon="{{contribution.icon}}" class="fa fa-3x s32 md-secondary md-hue-1" aria-label="Cancelar"></md-icon> <span>{{contribution.quantity}}&euro; ~ {{contribution.equivalent}} </span> </div> <md-radio-button flex ng-value="contribution.quantity" class="md-secondary" aria-label="{{contribution.quantity}}&euro; ~ {{contribution.equivalent}}"> </md-radio-button> </div> </div> </md-radio-group> <md-divider></md-divider> <div class="summary" flex layout="row" layout-align="space-between center"> <div flex-initial> Con esa contribución, podrías contribuir para <i>{{selectedContribution()}}</i> </div> </div> <h3>Campañas</h3> <md-divider></md-divider> <md-list ng-cloak> <md-list-item ng-repeat="campaign in campaigns" layout="row"> <div layout="column" flex layout-wrap> <div layout="row" flex layout-wrap> <p><b> {{ campaign.name }}: </b><i> {{ campaign.description }} </i></p> </div> <md-progress-linear md-mode="determinate" value="{{(campaign.current/campaign.objective)*100}}"></md-progress-linear> </div> <md-checkbox class="md-secondary" ng-model="campaign.selected"></md-checkbox> </md-list-item> </md-list> </form> </div> </md-content>')}]);